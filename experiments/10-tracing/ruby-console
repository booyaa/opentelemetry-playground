#!/bin/bash

DOCKER_COMPOSE_FILE=docker-compose-ruby-console.yml
echo "$DOCKER_COMPOSE_FILE" > .docker-compose-context.config
docker compose --file "$DOCKER_COMPOSE_FILE" up --detach

clear

echo "🕸️ HTTP request sent to http://localhost:4567, getting logs..."

while ! curl -s http://localhost:4567 > /dev/null; do
  sleep 1
done

docker compose --file "$DOCKER_COMPOSE_FILE" logs | grep -v redis-1
echo " "

# shellcheck disable=SC2162
read -p "Press enter to stop experiment"

docker compose --file "$DOCKER_COMPOSE_FILE" down
