services:
  web:
    build: web
    command: bundle exec rackup --host 0.0.0.0 --port 4567
    ports:
     - "4567:4567"
    volumes:
     - ./web:/code
    links:
     - redis
    environment:
     - OTEL_TRACES_EXPORTER=console

  redis:
    image: redis

  # even though this service is enabled, the app is configured (environment
  # variable) to dump the traces into the ruby console.
  otel-collector:
    image: otel/opentelemetry-collector-contrib
    volumes:
        - ./opentelemetry/debug-collector-config.yaml:/etc/otelcol-contrib/config.yaml
    ports:
      - 4318:4318 # OTLP http receiver
